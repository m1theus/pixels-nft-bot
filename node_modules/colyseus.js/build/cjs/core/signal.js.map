{"version":3,"file":"signal.js","sources":["../../../src/core/signal.ts"],"sourcesContent":["type FunctionParameters<T extends (...args: any[]) => any> =\n  T extends (...args: infer P) => any\n    ? P\n    : never;\n\nexport class EventEmitter<CallbackSignature extends (...args: any[]) => any> {\n  handlers: Array<CallbackSignature> = [];\n\n  register(cb: CallbackSignature, once: boolean = false) {\n    this.handlers.push(cb);\n    return this;\n  }\n\n  invoke(...args: FunctionParameters<CallbackSignature>) {\n    this.handlers.forEach((handler) => handler.apply(this, args));\n  }\n\n  invokeAsync(...args: FunctionParameters<CallbackSignature>) {\n    return Promise.all(this.handlers.map((handler) => handler.apply(this, args)));\n  }\n\n  remove (cb: CallbackSignature) {\n    const index = this.handlers.indexOf(cb);\n    this.handlers[index] = this.handlers[this.handlers.length - 1];\n    this.handlers.pop();\n  }\n\n  clear() {\n    this.handlers = [];\n  }\n}\n\nexport function createSignal<CallbackSignature extends (...args: any[]) => void | Promise<any>>()\n  : \n   {\n    once: (cb: CallbackSignature) => void;\n    remove: (cb: CallbackSignature) => void,\n    invoke: (...args: FunctionParameters<CallbackSignature>) => void,\n    invokeAsync: (...args: FunctionParameters<CallbackSignature>) => Promise<any[]>,\n    clear: () => void,\n  } & ((this: any, cb: CallbackSignature) => EventEmitter<CallbackSignature> )\n  {\n  const emitter = new EventEmitter<CallbackSignature>();\n\n  function register(this: any, cb: CallbackSignature): EventEmitter<CallbackSignature> {\n    return emitter.register(cb, this === null);\n  };\n\n  register.once = (cb: CallbackSignature) => {\n    const callback: any = function (...args: any[]) {\n      cb.apply(this, args);\n      emitter.remove(callback);\n    }\n    emitter.register(callback);\n  }\n  register.remove = (cb: CallbackSignature) => emitter.remove(cb)\n  register.invoke = (...args: FunctionParameters<CallbackSignature>) => emitter.invoke(...args);\n  register.invokeAsync = (...args: FunctionParameters<CallbackSignature>) => emitter.invokeAsync(...args);\n  register.clear = () => emitter.clear();\n\n  return register;\n}"],"names":[],"mappings":"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"}